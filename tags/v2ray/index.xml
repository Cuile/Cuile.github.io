<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>V2ray on 瘦了就帅了</title><link>https://blog.cuile.com/tags/v2ray/</link><description>Recent content in V2ray on 瘦了就帅了</description><generator>Hugo</generator><language>zh-cn</language><lastBuildDate>Thu, 26 Feb 2026 02:59:37 +0000</lastBuildDate><atom:link href="https://blog.cuile.com/tags/v2ray/index.xml" rel="self" type="application/rss+xml"/><item><title>OpenWRT 配置透明代理</title><link>https://blog.cuile.com/post/openwrt/openwrt_shadowsocks_proxy/</link><pubDate>Mon, 07 Feb 2022 13:37:19 +0800</pubDate><guid>https://blog.cuile.com/post/openwrt/openwrt_shadowsocks_proxy/</guid><description>&lt;p>本文记录OpenWrt设置透明代理的步骤及原理。&lt;/p>
&lt;h2 id="1-系统环境">1. 系统环境&lt;/h2>
&lt;ul>
&lt;li>硬件环境：Windows 10 Hyper-V虚拟机，单核处理器，256M内存&lt;/li>
&lt;li>固件版本：OpenWrt 19.07.6 r11278-8055e38794 / LuCI openwrt-19.07 branch git-21.101.59933-c56d9f2&lt;/li>
&lt;li>&lt;a href="https://github.com/shadowsocks/openwrt-shadowsocks/releases">shadowsocks-libev：3.3.5&lt;/a>&lt;/li>
&lt;li>luci-app-shadowsocks：2.0.2&lt;/li>
&lt;li>&lt;a href="https://github.com/honwen/openwrt-v2ray-plugin/releases">v2ray-plugin：4.37.3-20210413&lt;/a>&lt;/li>
&lt;li>ChinaDNS：1.3.3&lt;/li>
&lt;li>luci-app-chinadns：1.6.2&lt;/li>
&lt;li>https-dns-proxy：2021-01-17-5&lt;/li>
&lt;li>luci-app-https-dns-proxy：git-21.062.76689-a607f9c-1&lt;/li>
&lt;li>luci-i18n-https-dns-proxy-zh-cn：git-21.062.76689-a607f9c-1&lt;/li>
&lt;/ul>
&lt;h2 id="2-运行流程">2. 运行流程&lt;/h2>
&lt;p>透明代理的运行原理主要由&lt;code>DNS访问流程&lt;/code>、&lt;code>IP访问流程&lt;/code>两部分组成组成&lt;/p>
&lt;h3 id="21-dns访问流程">2.1 DNS访问流程&lt;/h3>
&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">flowchart LR
 lh((localhost));
 dm(Dnsmasq);
 cd(ChinaDNS);
 hdp(https-dns-proxy);
 ss(Shadowsocks);
 fd(国外DNS);
 dd(国内DNS);

 lh -- 1 udp:53 --&amp;gt; dm;
 dm -- 2 udp:5555 --&amp;gt; cd;
 cd -- 3.1 udp:5353--&amp;gt; hdp;
 cd -- 3.2 udp --&amp;gt; dd;
 hdp -- 4 tcp --&amp;gt; ss;
 ss -- 5 tcp --&amp;gt; fd;

 fd -. 6 .-&amp;gt; ss;
 ss -. 7 .-&amp;gt; hdp;
 hdp -. 8.1 .-&amp;gt; cd;
 dd -. 8.2 .-&amp;gt; cd;
 cd -. 9 缓存 .-&amp;gt; dm;
 dm -. 10 IP地址 .-&amp;gt; lh;
&lt;/code>&lt;/pre>&lt;h3 id="22-ip访问流程">2.2 IP访问流程&lt;/h3>
&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">flowchart LR
 fs(国外服务器);
 ds(国内服务器);
 lh((localhost));
 route{chinadns_chnroute.txt};
 ss(Shadowsocks);

 lh -- 1 --&amp;gt; route;
 route -- 2.1 国内IP --&amp;gt; ds;
 route -- 2.2 国外IP --&amp;gt; ss;
 ss -- 3 加密访问 --&amp;gt; fs;

 fs -. 4 返回加密数据 .-&amp;gt; ss;
 ds -. 5.1 返回数据 .-&amp;gt; lh;
 ss -. 5.2 返回解密数据 .-&amp;gt; lh;
&lt;/code>&lt;/pre>&lt;h2 id="3-配置">3. 配置&lt;/h2>
&lt;h3 id="31-shadowsocks-libev--v2ray-plugin">3.1 Shadowsocks-libev + v2ray-plugin&lt;/h3>
&lt;ul>
&lt;li>&lt;code>服务器管理&lt;/code>-&lt;code>编辑服务器&lt;/code>-&lt;code>插件参数&lt;/code>：一定要加上&amp;quot;loglevel=none&amp;quot;，如果不加v2ray-plugin插件几分钟就会被系统杀死&lt;/li>
&lt;li>&lt;code>访问控制&lt;/code>-&lt;code>被忽略IP列表&lt;/code>：/etc/chinadns_chnroute.txt&lt;/li>
&lt;/ul>
&lt;h3 id="32-https-dns-proxy">3.2 https-dns-proxy&lt;/h3>
&lt;p>由于使用了v2ray-plugin 插件，导致Shadowsocks不再支持UDP包，所以使用TCP的方式查询DNS&lt;/p></description></item></channel></rss>