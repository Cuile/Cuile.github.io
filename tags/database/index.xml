<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Database on ç˜¦äº†å°±å¸…äº†</title><link>https://blog.cuile.com/tags/database/</link><description>Recent content in Database on ç˜¦äº†å°±å¸…äº†</description><generator>Hugo</generator><language>zh-cn</language><lastBuildDate>Thu, 26 Feb 2026 02:59:37 +0000</lastBuildDate><atom:link href="https://blog.cuile.com/tags/database/index.xml" rel="self" type="application/rss+xml"/><item><title>PostgreSQLç»´æŠ¤æ‰‹å†Œ</title><link>https://blog.cuile.com/post/database/postgresql_manual/</link><pubDate>Sat, 20 Sep 2025 22:26:06 +0800</pubDate><guid>https://blog.cuile.com/post/database/postgresql_manual/</guid><description>&lt;h1 id="postgresql-é¢‘ç¹è¯»å†™æ•°æ®åº“çš„å®šæœŸç»´æŠ¤">PostgreSQL é¢‘ç¹è¯»å†™æ•°æ®åº“çš„å®šæœŸç»´æŠ¤&lt;/h1>
&lt;p>&lt;strong>æ˜¯çš„ï¼Œé¢‘ç¹è¯»å†™çš„ PostgreSQL æ•°æ®åº“ç»å¯¹éœ€è¦å®šæœŸç»´æŠ¤&lt;/strong>ã€‚è¿™æ˜¯ä¿è¯æ•°æ®åº“é•¿æœŸç¨³å®šè¿è¡Œã€ç»´æŒé«˜æ€§èƒ½å’Œé¿å…æ•°æ®æŸåçš„å…³é”®æŽªæ–½ã€‚&lt;/p>
&lt;h2 id="-å¿…é¡»çš„å®šæœŸç»´æŠ¤ä»»åŠ¡">ðŸ”§ å¿…é¡»çš„å®šæœŸç»´æŠ¤ä»»åŠ¡&lt;/h2>
&lt;h3 id="1-vacuum-ç»´æŠ¤æœ€é‡è¦">1. &lt;strong>VACUUM ç»´æŠ¤ï¼ˆæœ€é‡è¦ï¼‰&lt;/strong>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- å¸¸è§„VACUUMï¼ˆæŽ¨èæ¯æ—¥æ‰§è¡Œï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">VACUUM&lt;/span> &lt;span style="color:#66d9ef">ANALYZE&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- é’ˆå¯¹ç‰¹å®šè¡¨çš„VACUUM
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">VACUUM&lt;/span> &lt;span style="color:#66d9ef">ANALYZE&lt;/span> your_busiest_table;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- å½»åº•çš„VACUUMï¼ˆå»ºè®®æ¯å‘¨æˆ–æ¯æœˆï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">VACUUM&lt;/span> &lt;span style="color:#66d9ef">FULL&lt;/span> &lt;span style="color:#66d9ef">VERBOSE&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2-analyze-ç»Ÿè®¡ä¿¡æ¯æ›´æ–°">2. &lt;strong>ANALYZE ç»Ÿè®¡ä¿¡æ¯æ›´æ–°&lt;/strong>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨éœ€è¦ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">ANALYZE&lt;/span> &lt;span style="color:#66d9ef">VERBOSE&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- é’ˆå¯¹ç‰¹å®šè¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">ANALYZE&lt;/span> &lt;span style="color:#66d9ef">VERBOSE&lt;/span> your_busiest_table;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3-ç´¢å¼•ç»´æŠ¤">3. &lt;strong>ç´¢å¼•ç»´æŠ¤&lt;/strong>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- é‡å»ºç¢Žç‰‡åŒ–ä¸¥é‡çš„ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">REINDEX&lt;/span> &lt;span style="color:#66d9ef">INDEX&lt;/span> your_index_name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">REINDEX&lt;/span> &lt;span style="color:#66d9ef">TABLE&lt;/span> your_table_name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- å¹¶å‘é‡å»ºï¼ˆPostgreSQL 12+ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">REINDEX&lt;/span> &lt;span style="color:#66d9ef">INDEX&lt;/span> CONCURRENTLY your_index_name;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="-æŽ¨èç»´æŠ¤è®¡åˆ’">ðŸ“… æŽ¨èç»´æŠ¤è®¡åˆ’&lt;/h2>
&lt;h3 id="æ¯æ—¥ç»´æŠ¤">æ¯æ—¥ç»´æŠ¤&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- è‡ªåŠ¨VACUUMé€šå¸¸è¶³å¤Ÿï¼Œä½†å¯ä»¥è¡¥å……
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">VACUUM&lt;/span> &lt;span style="color:#66d9ef">ANALYZE&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ¯å‘¨ç»´æŠ¤">æ¯å‘¨ç»´æŠ¤&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- æ›´å½»åº•çš„ç»´æŠ¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">VACUUM&lt;/span> &lt;span style="color:#66d9ef">FULL&lt;/span> &lt;span style="color:#66d9ef">ANALYZE&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">CHECKPOINT&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ¯æœˆç»´æŠ¤">æ¯æœˆç»´æŠ¤&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- å…¨é¢ç»´æŠ¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">REINDEX&lt;/span> &lt;span style="color:#66d9ef">DATABASE&lt;/span> your_database;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">VACUUM&lt;/span> &lt;span style="color:#66d9ef">FULL&lt;/span> &lt;span style="color:#66d9ef">VERBOSE&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">ANALYZE&lt;/span> &lt;span style="color:#66d9ef">VERBOSE&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="-è‡ªåŠ¨åŒ–ç»´æŠ¤é…ç½®">âš™ï¸ è‡ªåŠ¨åŒ–ç»´æŠ¤é…ç½®&lt;/h2>
&lt;h3 id="1-è°ƒæ•´-autovacuum-è®¾ç½®postgresqlconf">1. è°ƒæ•´ autovacuum è®¾ç½®ï¼ˆpostgresql.confï¼‰&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é’ˆå¯¹é¢‘ç¹è¯»å†™æ•°æ®åº“çš„ä¼˜åŒ–è®¾ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">autovacuum&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">on&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">autovacuum_vacuum_scale_factor&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">autovacuum_analyze_scale_factor&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">0.05&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">autovacuum_vacuum_cost_delay&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">10ms&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">autovacuum_vacuum_cost_limit&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">1000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2-ä½¿ç”¨-pg_cron-æ‰©å±•å®šæ—¶ä»»åŠ¡">2. ä½¿ç”¨ pg_cron æ‰©å±•å®šæ—¶ä»»åŠ¡&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- å®‰è£…pg_cron
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">CREATE&lt;/span> EXTENSION pg_cron;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- æ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡ŒVACUUM
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">SELECT&lt;/span> cron.schedule(&lt;span style="color:#e6db74">&amp;#39;0 3 * * *&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;VACUUM ANALYZE&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- æ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œç»´æŠ¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">SELECT&lt;/span> cron.schedule(&lt;span style="color:#e6db74">&amp;#39;0 2 * * 0&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;VACUUM FULL ANALYZE&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3-æ“ä½œç³»ç»Ÿå®šæ—¶ä»»åŠ¡crontab">3. æ“ä½œç³»ç»Ÿå®šæ—¶ä»»åŠ¡ï¼ˆcrontabï¼‰&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ¯å¤©æ‰§è¡Œç»´æŠ¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> * * * psql -d your_db -c &lt;span style="color:#e6db74">&amp;#34;VACUUM ANALYZE&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ¯å‘¨æ‰§è¡Œå…¨é¢ç»´æŠ¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> * * &lt;span style="color:#ae81ff">0&lt;/span> psql -d your_db -c &lt;span style="color:#e6db74">&amp;#34;VACUUM FULL ANALYZE; REINDEX DATABASE your_db&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="-ç›‘æŽ§å’Œç»´æŠ¤æ£€æŸ¥">ðŸ“Š ç›‘æŽ§å’Œç»´æŠ¤æ£€æŸ¥&lt;/h2>
&lt;h3 id="1-ç›‘æŽ§æ•°æ®åº“çŠ¶æ€">1. ç›‘æŽ§æ•°æ®åº“çŠ¶æ€&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- æ£€æŸ¥è¡¨è†¨èƒ€æƒ…å†µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">SELECT&lt;/span> schemaname, tablename, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> n_dead_tup, n_live_tup,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> round(n_dead_tup::numeric&lt;span style="color:#f92672">/&lt;/span>n_live_tup::numeric&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#ae81ff">100&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>) &lt;span style="color:#66d9ef">as&lt;/span> dead_ratio
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">FROM&lt;/span> pg_stat_user_tables
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">ORDER&lt;/span> &lt;span style="color:#66d9ef">BY&lt;/span> dead_ratio &lt;span style="color:#66d9ef">DESC&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- æ£€æŸ¥ç´¢å¼•çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">SELECT&lt;/span> schemaname, tablename, indexname,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> idx_scan, idx_tup_read, idx_tup_fetch
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">FROM&lt;/span> pg_stat_user_indexes;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2-æ£€æŸ¥-autovacuum-æ•ˆæžœ">2. æ£€æŸ¥ autovacuum æ•ˆæžœ&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- æŸ¥çœ‹autovacuumç»Ÿè®¡ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">SELECT&lt;/span> relname, last_vacuum, last_autovacuum, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> last_analyze, last_autoanalyze
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">FROM&lt;/span> pg_stat_user_tables;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="-ç»´æŠ¤æ³¨æ„äº‹é¡¹">ðŸš¨ ç»´æŠ¤æ³¨æ„äº‹é¡¹&lt;/h2>
&lt;ol>
&lt;li>&lt;strong>ç»´æŠ¤æ—¶é—´çª—å£&lt;/strong>ï¼šé€‰æ‹©ä¸šåŠ¡ä½Žå³°æœŸè¿›è¡Œ&lt;/li>
&lt;li>&lt;strong>VACUUM FULL è°¨æ…Žä½¿ç”¨&lt;/strong>ï¼šä¼šé”è¡¨ï¼Œå½±å“ä¸šåŠ¡&lt;/li>
&lt;li>&lt;strong>ç›‘æŽ§ç»´æŠ¤å½±å“&lt;/strong>ï¼šä½¿ç”¨ &lt;code>VERBOSE&lt;/code> é€‰é¡¹æŸ¥çœ‹è¯¦ç»†æƒ…å†µ&lt;/li>
&lt;li>&lt;strong>å¤‡ä»½ä¼˜å…ˆ&lt;/strong>ï¼šé‡è¦ç»´æŠ¤å‰å…ˆå¤‡ä»½æ•°æ®&lt;/li>
&lt;/ol>
&lt;h2 id="-é’ˆå¯¹é¢‘ç¹è¯»å†™æ•°æ®åº“çš„ç‰¹æ®Šç»´æŠ¤">ðŸŽ¯ é’ˆå¯¹é¢‘ç¹è¯»å†™æ•°æ®åº“çš„ç‰¹æ®Šç»´æŠ¤&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- é’ˆå¯¹çƒ­ç‚¹è¡¨å¢žåŠ ç»´æŠ¤é¢‘çŽ‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">ALTER&lt;/span> &lt;span style="color:#66d9ef">TABLE&lt;/span> your_busy_table &lt;span style="color:#66d9ef">SET&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> autovacuum_vacuum_scale_factor &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>.&lt;span style="color:#ae81ff">05&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> autovacuum_analyze_scale_factor &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>.&lt;span style="color:#ae81ff">02&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- ç›‘æŽ§é•¿äº‹åŠ¡å’Œé”
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">SELECT&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#66d9ef">FROM&lt;/span> pg_locks &lt;span style="color:#66d9ef">WHERE&lt;/span> &lt;span style="color:#66d9ef">granted&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">SELECT&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#66d9ef">FROM&lt;/span> pg_stat_activity &lt;span style="color:#66d9ef">WHERE&lt;/span> &lt;span style="color:#66d9ef">state&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;idle&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="-ç»´æŠ¤æœ€ä½³å®žè·µ">ðŸ’¡ ç»´æŠ¤æœ€ä½³å®žè·µ&lt;/h2>
&lt;ol>
&lt;li>&lt;strong>å®šæœŸæ£€æŸ¥&lt;/strong>ï¼šæ¯å‘¨æ£€æŸ¥æ•°æ®åº“çŠ¶æ€&lt;/li>
&lt;li>&lt;strong>è‡ªåŠ¨åŒ–&lt;/strong>ï¼šå°½å¯èƒ½è‡ªåŠ¨åŒ–ç»´æŠ¤ä»»åŠ¡&lt;/li>
&lt;li>&lt;strong>æ–‡æ¡£åŒ–&lt;/strong>ï¼šè®°å½•ç»´æŠ¤åŽ†å²å’Œé—®é¢˜&lt;/li>
&lt;li>&lt;strong>æµ‹è¯•&lt;/strong>ï¼šåœ¨æµ‹è¯•çŽ¯å¢ƒéªŒè¯ç»´æŠ¤è„šæœ¬&lt;/li>
&lt;li>&lt;strong>å®¹é‡è§„åˆ’&lt;/strong>ï¼šå®šæœŸè¯„ä¼°å­˜å‚¨å¢žé•¿è¶‹åŠ¿&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>æ€»ç»“&lt;/strong>ï¼šå¯¹äºŽé¢‘ç¹è¯»å†™çš„ PostgreSQL æ•°æ®åº“ï¼Œå®šæœŸç»´æŠ¤ä¸æ˜¯å¯é€‰é¡¹ï¼Œè€Œæ˜¯å¿…éœ€å“ã€‚é€šè¿‡åˆç†çš„ç»´æŠ¤è®¡åˆ’ï¼Œå¯ä»¥ç¡®ä¿æ•°æ®åº“çš„æ€§èƒ½ç¨³å®šæ€§å’Œæ•°æ®å®Œæ•´æ€§ã€‚&lt;/p></description></item><item><title>Centos7 å®‰è£… Postgresql</title><link>https://blog.cuile.com/post/database/postgresql_for_centos/</link><pubDate>Fri, 19 Jan 2024 13:37:15 +0800</pubDate><guid>https://blog.cuile.com/post/database/postgresql_for_centos/</guid><description>&lt;h2 id="å®‰è£…">å®‰è£…&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ yum install https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å®‰è£…æœåŠ¡ç«¯åŒ…&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ yum install postgresql10-server postgresql10
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="é…ç½®">é…ç½®&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åˆå§‹åŒ–æ•°æ®åº“ï¼Œè®¾ç½®è‡ªå¯åŠ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ /usr/pgsql-10/bin/postgresql-10-setup initdb
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ systemctl enable postgresql-10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ systemctl start postgresql-10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è®¾ç½®é˜²ç«å¢™è§„åˆ™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ iptables -A INPUT -p tcp -m tcp --dport &lt;span style="color:#ae81ff">5432&lt;/span> -j ACCEPT &lt;span style="color:#75715e">#å¼€æ”¾Postgresql 5432ç«¯å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ service iptables save &lt;span style="color:#75715e"># ä¿å­˜é˜²ç«å¢™è§„åˆ™&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="é…ç½®è¿œç¨‹è®¿é—®">é…ç½®è¿œç¨‹è®¿é—®&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åˆ‡æ¢è‡³ç”¨æˆ·&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ su - postgres
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">; ./10/data/postgres.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">- #listen_address&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">+ listen_address&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">; ./10/data/pg_hba.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">; å…è®¸æ‰€æœ‰IPv4åœ°å€&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">+ host all all 0.0.0.0/0 scram-sha-256&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ç™»å½•æ•°æ®åº“">ç™»å½•æ•°æ®åº“&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ psql -U postgres
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- è®¾ç½®æ•°æ®è¿è¡Œå‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">ALTER&lt;/span> &lt;span style="color:#66d9ef">SYSTEM&lt;/span> &lt;span style="color:#66d9ef">SET&lt;/span> listen_addresses &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;*&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">ALTER&lt;/span> &lt;span style="color:#66d9ef">SYSTEM&lt;/span> &lt;span style="color:#66d9ef">SET&lt;/span> port &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">5432&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">ALTER&lt;/span> &lt;span style="color:#66d9ef">SYSTEM&lt;/span> &lt;span style="color:#66d9ef">SET&lt;/span> password_encryption &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;scram-sha-256&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- ä¿®æ”¹é»˜è®¤ç”¨æˆ·å¯†ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">ALTER&lt;/span> &lt;span style="color:#66d9ef">USER&lt;/span> postgres &lt;span style="color:#66d9ef">with&lt;/span> &lt;span style="color:#66d9ef">encrypted&lt;/span> password &lt;span style="color:#e6db74">&amp;#39;ä½ çš„å¯†ç &amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- é€€å‡ºæ•°æ®åº“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>q
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- é€€å‡ºç”¨æˆ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>exit 
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é‡å¯æœåŠ¡">é‡å¯æœåŠ¡&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl restart postgresql-10
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>