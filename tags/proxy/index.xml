<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Proxy on 瘦了就帅了</title><link>https://blog.cuile.com/tags/proxy/</link><description>Recent content in Proxy on 瘦了就帅了</description><generator>Hugo</generator><language>zh-cn</language><lastBuildDate>Sun, 05 Oct 2025 02:09:22 +0000</lastBuildDate><atom:link href="https://blog.cuile.com/tags/proxy/index.xml" rel="self" type="application/rss+xml"/><item><title>snap 设置代理</title><link>https://blog.cuile.com/post/snap/snap_proxy/</link><pubDate>Fri, 19 Jan 2024 13:15:15 +0800</pubDate><guid>https://blog.cuile.com/post/snap/snap_proxy/</guid><description>&lt;p>使用snap 的过程中经常遇到无法链接的情况。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ sudo snap install code --classic
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>error: unable to contact snap store
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这是因为SnapCraft将软件包放在自己的海外服务器上，因为众所周知的原因，访问速度异常缓慢，不加代理的情况下，基本无法使用。&lt;/p>
&lt;p>Linux上的一些应用程序会通过读取环境变量 http_proxy 和 https_proxy 来应用代理服务器设置，典型的有Chrome。&lt;/p>
&lt;p>然而，Snap比较特别，它不会从环境变量中上述环境变量中读取代理服务器设置，因此直接使用&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">export http_proxy&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">[代理服务器地址]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">export https_proxy&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">[代理服务器地址]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>是不起作用的。&lt;/p>
&lt;p>网上有一些修改配置文件的方法，个人觉得很麻烦，也容易出错，所以选了最简单可靠的命令行模式。&lt;/p>
&lt;h2 id="1-设置命令">1. 设置命令&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ sudo snap set system proxy.https&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://代理服务器地址:代理端口&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo snap set system proxy.http&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://代理服务器地址:代理端口&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="参考文档">参考文档&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://www.cnblogs.com/brep/p/14643507.html">ubuntu snap install 代理设置&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.jianshu.com/p/0891648b657a">为Snapd设置代理&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>frp安装配置</title><link>https://blog.cuile.com/post/linux/frp_install/</link><pubDate>Wed, 28 Dec 2022 17:15:15 +0800</pubDate><guid>https://blog.cuile.com/post/linux/frp_install/</guid><description>&lt;h2 id="1-使用手册">1. 使用手册&lt;/h2>
&lt;p>看完这3篇足以把服务建起来，非常方便&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/fatedier/frp/blob/master/README_zh.md">官方文档&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.appinn.com/frp/">教程1&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://meta.appinn.net/t/frp/11319/13">教程2&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="2-服务端安装配置">2. 服务端安装配置&lt;/h2>
&lt;p>可直接使用 Docker 的配置进行&lt;/p>
&lt;h2 id="3-客户端下载-安装运行">3. 客户端下载、 安装、运行&lt;/h2>
&lt;p>原本也想使用Docker镜像，但发现kvm之间通过Docker通信好像有问题，所幸在宿主机上可以直接使用release文件。
【&lt;em>注意：每次添加新的客户端，要同步更新服务端的端口配置&lt;/em>】&lt;/p>
&lt;h3 id="31-下载">3.1. 下载&lt;/h3>
&lt;p>&lt;a href="https://github.com/fatedier/frp/releases">官网下载地址&lt;/a>【&lt;em>注意：s, c两端使用的版本号要相同&lt;/em>】&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ cd ~
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 下载安装软件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ yum install wget tar git
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 下载 frp&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ wget -c https://github.com/fatedier/frp/releases/download/v0.34.3/frp_0.34.3_linux_amd64.tar.gz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ tar -axvf frp_0.34.3_linux_amd64.tar.gz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ rm -rf frp_0.34.3_linux_amd64.tar.gz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 下载 frp 配置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ git clone https://github.com/Cuile/frp.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="32-安装">3.2. 安装&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 此处只能使用硬链接，使用软链接会导致无法启动服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ mkdir /etc/frp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ ln -b ~/frp/conf/frpc-pve.ini /etc/frp/frpc.ini
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装运行文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ ln -b ~/frp_0.34.3_linux_amd64/frpc /usr/bin/frpc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ ln -b ~/frp_0.34.3_linux_amd64/systemd/frpc.service /lib/systemd/system/frpc.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="33-运行">3.3. 运行&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ systemctl enable frpc.service &lt;span style="color:#75715e">##设定指定服务开机开启&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ systemctl disable frpc.service &lt;span style="color:#75715e">##设定指定服务开机关闭&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ systemctl start frpc.service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ systemctl stop frpc.service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ systemctl restart frpc.service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ systemctl status frpc.service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ systemctl list-units | grep frpc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="34-更新">3.4. 更新&lt;/h3>
&lt;p>通过 git 更新 frpc 的配置后，要重新链接配置文件&lt;/p></description></item><item><title>OpenWRT 配置透明代理</title><link>https://blog.cuile.com/post/openwrt/openwrt_shadowsocks_proxy/</link><pubDate>Mon, 07 Feb 2022 13:37:19 +0800</pubDate><guid>https://blog.cuile.com/post/openwrt/openwrt_shadowsocks_proxy/</guid><description>&lt;p>本文记录OpenWrt设置透明代理的步骤及原理。&lt;/p>
&lt;h2 id="1-系统环境">1. 系统环境&lt;/h2>
&lt;ul>
&lt;li>硬件环境：Windows 10 Hyper-V虚拟机，单核处理器，256M内存&lt;/li>
&lt;li>固件版本：OpenWrt 19.07.6 r11278-8055e38794 / LuCI openwrt-19.07 branch git-21.101.59933-c56d9f2&lt;/li>
&lt;li>&lt;a href="https://github.com/shadowsocks/openwrt-shadowsocks/releases">shadowsocks-libev：3.3.5&lt;/a>&lt;/li>
&lt;li>luci-app-shadowsocks：2.0.2&lt;/li>
&lt;li>&lt;a href="https://github.com/honwen/openwrt-v2ray-plugin/releases">v2ray-plugin：4.37.3-20210413&lt;/a>&lt;/li>
&lt;li>ChinaDNS：1.3.3&lt;/li>
&lt;li>luci-app-chinadns：1.6.2&lt;/li>
&lt;li>https-dns-proxy：2021-01-17-5&lt;/li>
&lt;li>luci-app-https-dns-proxy：git-21.062.76689-a607f9c-1&lt;/li>
&lt;li>luci-i18n-https-dns-proxy-zh-cn：git-21.062.76689-a607f9c-1&lt;/li>
&lt;/ul>
&lt;h2 id="2-运行流程">2. 运行流程&lt;/h2>
&lt;p>透明代理的运行原理主要由&lt;code>DNS访问流程&lt;/code>、&lt;code>IP访问流程&lt;/code>两部分组成组成&lt;/p>
&lt;h3 id="21-dns访问流程">2.1 DNS访问流程&lt;/h3>
&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">flowchart LR
 lh((localhost));
 dm(Dnsmasq);
 cd(ChinaDNS);
 hdp(https-dns-proxy);
 ss(Shadowsocks);
 fd(国外DNS);
 dd(国内DNS);

 lh -- 1 udp:53 --&amp;gt; dm;
 dm -- 2 udp:5555 --&amp;gt; cd;
 cd -- 3.1 udp:5353--&amp;gt; hdp;
 cd -- 3.2 udp --&amp;gt; dd;
 hdp -- 4 tcp --&amp;gt; ss;
 ss -- 5 tcp --&amp;gt; fd;

 fd -. 6 .-&amp;gt; ss;
 ss -. 7 .-&amp;gt; hdp;
 hdp -. 8.1 .-&amp;gt; cd;
 dd -. 8.2 .-&amp;gt; cd;
 cd -. 9 缓存 .-&amp;gt; dm;
 dm -. 10 IP地址 .-&amp;gt; lh;
&lt;/code>&lt;/pre>&lt;h3 id="22-ip访问流程">2.2 IP访问流程&lt;/h3>
&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">flowchart LR
 fs(国外服务器);
 ds(国内服务器);
 lh((localhost));
 route{chinadns_chnroute.txt};
 ss(Shadowsocks);

 lh -- 1 --&amp;gt; route;
 route -- 2.1 国内IP --&amp;gt; ds;
 route -- 2.2 国外IP --&amp;gt; ss;
 ss -- 3 加密访问 --&amp;gt; fs;

 fs -. 4 返回加密数据 .-&amp;gt; ss;
 ds -. 5.1 返回数据 .-&amp;gt; lh;
 ss -. 5.2 返回解密数据 .-&amp;gt; lh;
&lt;/code>&lt;/pre>&lt;h2 id="3-配置">3. 配置&lt;/h2>
&lt;h3 id="31-shadowsocks-libev--v2ray-plugin">3.1 Shadowsocks-libev + v2ray-plugin&lt;/h3>
&lt;ul>
&lt;li>&lt;code>服务器管理&lt;/code>-&lt;code>编辑服务器&lt;/code>-&lt;code>插件参数&lt;/code>：一定要加上&amp;quot;loglevel=none&amp;quot;，如果不加v2ray-plugin插件几分钟就会被系统杀死&lt;/li>
&lt;li>&lt;code>访问控制&lt;/code>-&lt;code>被忽略IP列表&lt;/code>：/etc/chinadns_chnroute.txt&lt;/li>
&lt;/ul>
&lt;h3 id="32-https-dns-proxy">3.2 https-dns-proxy&lt;/h3>
&lt;p>由于使用了v2ray-plugin 插件，导致Shadowsocks不再支持UDP包，所以使用TCP的方式查询DNS&lt;/p></description></item></channel></rss>